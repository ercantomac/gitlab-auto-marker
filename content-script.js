console.log("content-script.js called");
var running = false;

function timer(ms) {
    return new Promise(res => setTimeout(res, ms));
};

async function autoMark() {
    running = true;
    console.log('autoMark() started');
    //var taskListArray = document.getElementsByClassName("task-list");

    var taskListItems = document.getElementsByClassName("task-list-item");
    var checkedTasks = 0;

    for (var i = 0; i < taskListItems.length; i++) {
        var taskListItemCheckboxes = taskListItems[i].getElementsByClassName("task-list-item-checkbox");
        if (taskListItemCheckboxes.length < 1) {
            continue;
        }

        if (!taskListItemCheckboxes[0].hasAttribute("checked")) {
            var attempts = 0;
            while (true) {
                if (taskListItems[i].classList.contains("enabled")) {
                    // TRIGGER CHECKBOX CLICK
                    checkedTasks++;
                    taskListItemCheckboxes[0].click();
                    break;
                } else {
                    // ELEMENT IS DISABLED, WAIT 500 MS AND TRY AGAIN
                    attempts++;
                    await timer(500);
                }

                if (attempts > 9) {
                    // FAILED TO CHECK AFTER (9 * 500) = 4500 MILLISECONDS
                    break;
                }
            }
        } else {
            // ALREADY CHECKED
        }
    }

    running = false;
    console.log('autoMark() finished');
    chrome.runtime.sendMessage({ greeting: "finished", checkedTasks: checkedTasks });
}


chrome.runtime.onMessage.addListener(
    function (request, sender, sendResponse) {
        if (request.greeting === "hello") {
            if (!running) {
                autoMark();
            }
        }
    }
);

// ⣿⣿⣿⣿⣿⣿⣿⣿⠟⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠉⠻⣿⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢺⣿⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠆⠜⣿⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⠿⠿⠛⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠻⣿⣿⣿
// ⣿⣿⡏⠁⠀⠀⠀⠀⠀⣀⣠⣤⣤⣶⣶⣶⣶⣶⣦⣤⡄⠀⠀⠀⠀⢀⣴⣿⣿
// ⣿⣿⣷⣄⠀⠀⠀⢠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⡧⠇⢀⣤⣶⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣾⣮⣭⣿⡻⣽⣒⠀⣤⣜⣭⠐⢐⣒⠢⢰⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⣏⣿⣿⣿⣿⣿⣿⡟⣾⣿⠂⢈⢿⣷⣞⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⣿⣽⣿⣿⣷⣶⣾⡿⠿⣿⠗⠈⢻⣿⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠻⠋⠉⠑⠀⠀⢘⢻⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⣿⡿⠟⢹⣿⣿⡇⢀⣶⣶⠴⠶⠀⠀⢽⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⣿⣿⣿⡿⠀⠀⢸⣿⣿⠀⠀⠣⠀⠀⠀⠀⠀⡟⢿⣿⣿⣿⣿⣿⣿⣿
// ⣿⣿⣿⡿⠟⠋⠀⠀⠀⠀⠹⣿⣧⣀⠀⠀⠀⠀⡀⣴⠁⢘⡙⣿⣿⣿⣿⣿⣿
// ⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⢿⠗⠂⠄⠀⣴⡟⠀⠀⡃⣿⣿⣿⣿⣿⣿


// ⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣶⣿⣿⣿⣿⣿⣿⣿⣶⣦⣀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⣤⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣄⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⢠
// ⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣛⣻⣿⣿⣟⣿⣿⣿⣷⠀⠀⠀
// ⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣫⣽⣾⣻⣾⣿⣿⣿⣿⡿⣿⣿⠀⠀⠀
// ⠀⠀⠀⢰⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠻⡿⠿⠟⠛⣟⣿⣽⠀⠀⠀
// ⠀⠀⠀⠸⣿⣿⣿⣷⣿⣿⣿⣿⡿⠍⠈⠀⠁⣴⡆⠀⠀⠠⢭⣮⣿⡶⠀⠀
// ⠀⡴⠲⣦⢽⣿⣿⣿⣿⣿⣟⣩⣨⣀⡄⣐⣾⣿⣿⣇⠠⣷⣶⣿⣿⡠⠁⠀
// ⠀⠃⢀⡄⠀⢻⣿⣿⣿⣿⣽⢿⣿⣯⣾⣿⣿⣿⣿⣿⢿⣿⣿⡟⣿⠀⠀⠀
// ⠀⠀⠣⠧⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⠟⢸⣿⠿⠿⠿⣧⠙⣿⣿⡿⠀⠀⠀
// ⠀⠀⠀⠁⠼⣒⡿⣿⣿⣿⣿⣿⣿⣿⣠⣬⠀⠀⠀⠀⣾⣷⡈⣿⡇⠀⠀⠀
// ⠀⠀⠀⠀⠀⠉⢳⣿⣿⣿⣿⣿⣿⣿⢟⠗⠼⠖⠒⠔⠉⠉⠻⣿⠇⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠈⣻⡿⣿⣿⣿⣿⡿⡀⣤⡄⠸⣰⣾⡒⣷⣴⣿⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠂⢸⡗⡄⠘⠭⣭⣷⣿⣮⣠⣌⣫⣿⣷⣿⣿⠃⠀⠈⠀⠀
// ⠀⠀⠀⠀⠀⠈⠀⢸⣿⣾⣷⣦⡿⣿⣿⣿⡿⢻⠞⣹⣿⣿⠏⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⢘⠀⠘⢻⡿⢿⣋⣤⣤⠌⠉⠛⠛⠀⠈⠉⠁⠀⠀⠀⠀⠀⡀


// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣴⣶⣶⣶⣿⣶⢶⣄⠀⠀⢀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⣿⠟⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⢟⣿⡿⣫⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⣫⣾⣿⣿⠿⣫⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣟⣵⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠛⠿⠛⠛⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡀⠀⠀⠀
// ⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠉⠻⢿⣷⣝⢿⣿⣿⣿⣿⣻⣿⣇⠀⠀⠀
// ⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢿⣷⣝⢿⣟⢿⣿⣽⣿⡆⠀⠀
// ⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣞⢷⣿⡾⣿⣿⣿⣿⠀⠀
// ⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣹⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⡿⡞⣿⣿⣿⣿⣿⣿⡇⠀
// ⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠸⣿⣿⣿⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣷⣿⣿⣿⣿⣿⣿⡆⠀
// ⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⡇⣿⡏⢻⣿⣷⡀⠀⠙⢿⠿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡠⣾⣿⣿⣿⣿⣿⣿⣿⣇⠀
// ⠀⠀⠀⣿⣿⣿⣿⣿⣿⡟⣿⣿⣿⢸⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀
// ⠀⠀⠀⣿⣿⣿⣿⣿⣿⠀⠈⠋⠉⠸⠉⠹⡟⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠿⠟⠉⢸⣿⣿⣿⡟⠀
// ⠀⠀⢰⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⢀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⡀⠀⠸⣿⣿⣿⠃⠀
// ⠀⠀⢸⣿⣿⢿⣿⣿⠏⠻⣦⡠⣶⡿⢟⣩⣽⣷⣶⣶⣶⠤⣴⣦⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣴⣒⣛⡛⠛⡿⣄⠀⣿⣿⣿⠀⠀
// ⠀⠀⠘⡏⡏⢀⣿⣿⠀⠀⠙⠿⢻⢃⣠⣴⠾⣿⣿⣿⣿⣿⣦⡉⠛⢻⡥⢤⣽⣿⣿⣿⣿⣿⣿⣿⡿⣿⣿⣿⡿⠆⣿⣿⠏⠀⠀
// ⠀⠀⠀⢱⢧⠸⣿⣿⠀⠀⠀⠀⢸⠙⠛⢯⣀⣙⣛⣋⣬⣿⠟⢩⣿⡿⠀⠀⢰⣿⡿⠿⣏⣙⣿⣟⣣⣼⣿⠋⠀⠀⣽⡇⠀⠀⠀
// ⠀⠀⠀⠈⣿⣆⣿⣿⡀⠀⠀⠀⠸⡄⠀⠀⠈⠉⡩⠭⠟⡿⠀⠸⣵⠃⠀⠀⠈⣿⣿⣄⠀⠉⠛⠛⠛⢹⠇⠀⠀⡼⣿⡇⠀⠀⠀
// ⠀⠀⠀⠀⠘⣿⡿⣿⣇⠀⠀⠀⠀⠈⠂⠀⠀⠀⠀⠀⢀⣀⣤⡞⠁⠀⠀⠀⠀⢸⣏⠻⣅⠀⠀⠀⠀⠀⣀⡠⠊⠀⣿⠇⠀⠀⠀
// ⠀⠀⠀⠀⠀⢹⡇⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠁⠀⠘⠁⠀⠀⠀⠀⠀⢘⣿⡄⠀⠉⠉⠉⠉⠉⠀⠀⠀⡤⣿⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠻⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣶⣶⣤⣀⣴⣾⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⣧⣿⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⢹⡟⠿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠛⠛⢻⡿⠛⠛⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⢠⡿⠋⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠈⣇⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⢳⠀⠀⠀⣼⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⢻⣳⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣶⣶⣤⣤⣦⣄⣀⠀⠀⠀⠀⢀⡏⠀⠀⢠⠃⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠈⣯⣷⡀⠀⠀⠀⠀⠀⠀⠀⠒⠛⠫⣉⣉⡀⠀⠉⠁⢀⣉⡩⠙⠒⠂⢀⡿⠀⠀⢀⠎⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⢷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠼⠿⠛⠛⠛⠻⠶⠄⠀⠀⡤⢾⠀⠀⢀⠎⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡴⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣷⡟⠲⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⡷⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⣀⣴⠛⣿⣿⠈⠙⢿⣿⡀⠀⠙⠓⠦⣤⣄⣀⣀⣀⣀⣀⣀⣀⣠⣤⠴⠚⠁⠀⣸⠇⣿⣿⣦⣀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⣀⣴⣾⣿⡟⠀⢻⣿⡀⠀⠀⠈⠛⠲⢤⣀⡀⠀⠀⠉⠉⠙⠛⠛⠛⠉⠉⠀⠀⠀⣀⣴⡿⠀⣿⣿⣿⣿⣷⣄⡀⠀⠀⠀
// ⣠⣴⣾⣿⣿⣿⣿⡇⠀⠀⠙⣷⣄⡀⠀⠀⠀⠀⠀⠈⠉⠁⠀⢀⣀⣀⣀⣠⣤⣤⣴⣶⣿⣿⠋⠀⠀⣿⣿⣿⣿⣿⣿⣿⣦⣄⡀
